{% extends '_base.njk' %}

{% set thispage = 'events' %}
{% set pagetitle = 'Live Quiz' %}

{% block pagecontent %}
	<div class="container">
		<fieldset class="question">
			<legend id="info">&nbsp;&nbsp;Waiting for question&nbsp;&nbsp;</legend>
			<div id="question-container">
			</div>
			<button onclick="submit()">Submit</button>
		</fieldset>
	</div>
{% endblock %}

{% block customcss %}
	<style>

	</style>
{% endblock %}

{% block customjs %}
	<script>
		let quesCounter = 1;

		function showQuestion(type, options) {
			document.getElementById('question-no').innerHTML = `&nbsp;&nbsp;Question #${quesCounter}&nbsp;&nbsp;`;
			const div = document.createElement('div');
			div.classList.add('answer');
			div.classList.add(type);
			if(type === 'mcq') {
				options.forEach(option => {
					div.innerHTML += ```
					<div class="option">
						<input type="radio" id="${option}" name="${option}" class="option-input" value="${option}"/>
						<div class="option-design"></div>
						<div class="option-text" for="${option}">${option}</div>
					</div>
					```;
				});
			}
			else {
				div.innerHTML = `<input type="text" id='ans'>`;
			}
			document.getElementById('question-container').appendChild(div);
		}

		async function submit() {
			let submitted;
			const ans = document.getElementsByClassName('class')[0]
			if (ans.classList[1] === 'mcq') {
				submitted = ans.querySelector("input:checked")?.value;
			}
			else {
				submitted = document.getElementById('ans').value;
			}
			const response = await axios.post('/live/submit', {submitted});
		}

		socket.on('question', req => {
			showQuestion()
		});
		
		// QUestion submit, a bit done
		// Fetch new question
		// Check for quiz end
		// make hmtl on fetching new questions
		// save user submitted responses
	</script>
{% endblock %}

{% set scripts = ['https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js'] %}
